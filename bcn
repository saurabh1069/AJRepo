# Load the Outlook COM object
Add-Type -AssemblyName 'Microsoft.Office.Interop.Outlook'
$Outlook = New-Object -ComObject Outlook.Application

# Get the Outlook Namespace
$namespace = $Outlook.GetNamespace('MAPI')

# Define a function to recursively retrieve folder statistics
Function Get-FolderStatistics($folder) {
    $folderName = $folder.Name
    $itemCount = $folder.Items.Count
    $unreadItemCount = $folder.Items.Restrict('[Unread] = True').Count

    Write-Host "Folder Name: $folderName"
    Write-Host "Total Items: $itemCount"
    Write-Host "Unread Items: $unreadItemCount"

    # Recursively process subfolders
    foreach ($subfolder in $folder.Folders) {
        Get-FolderStatistics $subfolder
    }
}

# Get the root folder of the mailbox
$mailbox = $namespace.Folders.Item(1)  # 1 corresponds to the primary mailbox

# Call the function to start collecting folder statistics
Get-FolderStatistics $mailbox

# Release COM objects
[System.Runtime.InteropServices.Marshal]::ReleaseComObject($Outlook) | Out-Null
